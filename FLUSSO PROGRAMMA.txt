Il server:

mantiene connessioni

mantiene chat (private e gruppi)

mantiene storico messaggi

inoltra messaggi in real-time

1Ô∏è‚É£ Avvio server

server avvia socket
server accetta connessioni
per ogni client ‚Üí thread dedicato

2Ô∏è‚É£ Client si connette

invia username
server salva:
utenti[username] = conn


3Ô∏è‚É£ Server THREAD CLIENT

Il thread rimane sempre in ascolto:
while True:
    ricevi JSON
    capisci il tipo
    agisci



4Ô∏è‚É£ Client apre una chat

Client ‚Üí server:
{
  "type": "get_history",
  "chat_id": "anna:luca"
}

Server:
trova la chat
prende messages[-N:]
risponde con UN SOLO JSON

{
  "type": "history",
  "chat_id": "anna:luca",
  "messages": [...]
}


5Ô∏è‚É£ Client riceve history
Client:
svuota la UI
carica i messaggi ricevuti
NON richiede pi√π lo storico



6Ô∏è‚É£ Client invia un messaggio
Client ‚Üí server:

{
  "type": "message",
  "chat_id": "anna:luca",
  "from": "anna",
  "text": "ciao"
}



7Ô∏è‚É£ Server gestisce messaggio
Server:
salva il messaggio nello storico
inoltra il messaggio ai membri
chat["messages"].append(msg)
for utente in chat["membri"]:
    if utente in utenti:
        utenti[utente].sendall(...)


üëâ UN messaggio alla volta



8Ô∏è‚É£ Client riceve messaggio realtime

Client:
aggiunge il messaggio alla chat 


9Ô∏è‚É£ Chat nuova (privata o gruppo)

Client ‚Üí server:
{
  "type": "create_chat",
  "membri": ["anna", "luca"]
}


Server:

crea struttura vuota

risponde OK

Client:

apre chat

chiede lo storico ‚Üí riceve lista vuota